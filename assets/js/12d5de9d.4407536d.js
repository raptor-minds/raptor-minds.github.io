(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[534],{261:function(e,t,r){"use strict";r.r(t),r.d(t,{frontMatter:function(){return i},metadata:function(){return l},toc:function(){return c},default:function(){return d}});var a=r(2122),s=r(9756),o=(r(7294),r(3905)),n=["components"],i={},l={unversionedId:"distributed-system/message",id:"distributed-system/message",isDocsHomePage:!1,title:"Message Middleware",description:"Kafka",source:"@site/docs/distributed-system/message.md",sourceDirName:"distributed-system",slug:"/distributed-system/message",permalink:"/docs/distributed-system/message",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/distributed-system/message.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Raptor minds introduction",permalink:"/docs/intro"}},c=[{value:"Kafka",id:"kafka",children:[]},{value:"RocketMQ",id:"rocketmq",children:[{value:"Instalation",id:"instalation",children:[]},{value:"Transaction",id:"transaction",children:[]},{value:"Source code",id:"source-code",children:[]}]}],u={toc:c};function d(e){var t=e.components,i=(0,s.Z)(e,n);return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"kafka"},"Kafka"),(0,o.kt)("h2",{id:"rocketmq"},"RocketMQ"),(0,o.kt)("h3",{id:"instalation"},"Instalation"),(0,o.kt)("h4",{id:"compile"},"Compile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mvn -Prelease-all -DskipTests clean install -U\n")),(0,o.kt)("h4",{id:"start-nameserver"},"Start nameserver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"nohup ./mqnamesrv &\n")),(0,o.kt)("h4",{id:"start-broker"},"Start broker"),(0,o.kt)("h5",{id:"config-broker-conf"},"Config broker conf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"brokerIP1=112.126.66.246\nnamesrvAddr=112.126.66.246:9876\nautoCreateTopicEnable=true\nenablePropertyFilter=true\n")),(0,o.kt)("h5",{id:"start-broker-1"},"start broker"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./mqbroker -n localhost:9876 -c broker.conf\n")),(0,o.kt)("h4",{id:"start-console"},"Start console"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"https://github.com/apache/rocketmq-externals\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"}," java -jar rocketmq-console-ng-2.0.0.jar --rocketmq.config.namesrvAddr=127.0.0.1:9876\n")),(0,o.kt)("h3",{id:"transaction"},"Transaction"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(6842).Z})),(0,o.kt)("p",null,"The processing flow of RocketMQ in the distributed system can be generally descriped as followes\uff1a"),(0,o.kt)("h4",{id:"two-phase-tx-commit"},"Two phase tx commit"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Producer need to invoke A,B,C,D method in one Tx, the broker of rocket message queue will store these four message in one ",(0,o.kt)("strong",{parentName:"p"},"Half Queue"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The broker will start one thread to schedully call back the execution status of A, B,C, D. When the status is OK, then the broker will put the A,B,C,D message in the ",(0,o.kt)("strong",{parentName:"p"},"Final Queue"),"."))),(0,o.kt)("h3",{id:"source-code"},"Source code"),(0,o.kt)("h4",{id:"consumer"},"Consumer"),(0,o.kt)("p",null,"The questions are as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The speed of the consuming is much lower than the broker, if we use push model."),(0,o.kt)("li",{parentName:"ul"},"how to query or acquire the events or message from the broker?"),(0,o.kt)("li",{parentName:"ul"},"During the processing of the consuming message, what if the legency message already timeout, how to handle this?"),(0,o.kt)("li",{parentName:"ul"},"for the broker clusters, which ip or machine should I choose to pull message?")),(0,o.kt)("h4",{id:"producer"},"Producer"),(0,o.kt)("h4",{id:"broker"},"Broker"))}d.isMDXComponent=!0},6842:function(e,t,r){"use strict";t.Z=r.p+"assets/images/RocketMQ_Transaction-e7e3e4be3891e20e75c15e6265c57b38.png"}}]);